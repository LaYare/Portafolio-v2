/*
 * Liquid zoom v1.8.4
 * A jQuery plugin for a very smooth zoom of any kind of image
 * http://www.soslignes-ecrivain-public.fr/English-Blog.html
 * 
 * Copyright 2013-2015, Pascal Gautier 
 * 
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */

!function(o){instance=0,o.fn.liquidZoom=function(t){return defaultsettings={speedInOut:350,zoomViewStartFactor:1,dragMode:!1,responseSpeed:.05,mouseWheelSupport:!0,zoomFactor:.75,progressiveScan:!0,overZoomFactor:!1,zoomBar:!1,zoomCaptionSource:"title",zoomInfoText:!1,zoomLeftText:!1,blackWhitePreview:!1,autoZoomTour:!1,zoomTourSpeed:15,zoomTourShowSpeed:1e3},this.each(function(){t=o.extend({},defaultsettings,t),o.liquidZoomIC(this,t)})},o.liquidZoomIC=function(t,e){return t.liquidZoom||(t.liquidZoom=new o.liquidZoomI(t,e))},o.liquidZoomI=function(t,e){o(t).css({background:"none"}).find("img").each(function(){function t(){g&&(clearTimeout(b),i(),Q=!1,P=!e.progressiveScan,z=I=w.width(),n(),D=-(K*W)-q,E=-(K*L)-V,b=setInterval(function(){if(k){g=!1,Q&&(n(),S=z-w.width(),I+=e.responseSpeed*(z-w.width()),Math.abs(I-z)<1&&(I=z,Q=!1),w.css({width:I,height:I/j})),1>P&&(P+=.01),r();var o=-(K*W)-q,t=-(K*L)-V;D+=e.responseSpeed*P*(o-D),E+=e.responseSpeed*P*(t-E),w.css({top:E+V,left:D+q})}},8))}function i(){k=!1,B.css({width:"auto",height:"auto"}),G=B.width(),N=B.height(),B.css({width:x,height:C}),et&&B.stop(1,1).fadeOut(A),M.find(T).fadeOut(A),(e.zoomViewStartFactor>1||G*e.zoomViewStartFactor<x)&&(e.zoomViewStartFactor=1),X=G*e.zoomViewStartFactor,Y=N*e.zoomViewStartFactor,J=K=X/x-1,j=X/Y,r(),D=W*(1-X/x),E=L*(1-Y/C),v.append("<img src="+tt+">").find("img").css({display:"block",position:"absolute",opacity:1,top:E-V,left:D-q,width:X,height:Y}),v.find(".Zoominfo1, .Zoominfo2").stop(1,1).hide().delay(A).fadeIn(A),v.stop(1,1).animate({opacity:1,top:0,left:0,width:x,height:C},A).find("img").animate({top:E,left:D},A,function(){k=!0}),w=v.find("img");var o=B.attr(e.zoomCaptionSource);o&&Z.hide().html(o).delay(A).fadeIn(A),R.delay(A).fadeIn(A),e.zoomBar||R.remove(),e.zoomInfoText||v.find(".Zoominfo1").remove(),e.zoomLeftText||v.find(".Zoominfo2").remove(),0>K?(w.hide(),M.css({cursor:"auto"})):M.css({cursor:"pointer"})}function a(){v.width()&&(g=!0,B.fadeIn(A),M.find(T).stop(1,1).fadeIn(A),clearTimeout(b),v.find(".Zoominfo1, .Zoominfo2").hide(),v.animate({opacity:0,top:v.height()/2,left:v.width()/2,width:0,height:0},A),w.animate({top:E,left:D},A,function(){o(this).remove(),k&&(B.fadeIn(A),M.find(T).stop(1,1).fadeIn(A))}),Z.stop(1,1).hide(),R.stop(1,1).hide())}function n(){zoomInfo2=v.find(".Zoominfo2").removeClass("Zoomwarning Zoomdefault"),H=Math.pow(e.overZoomFactor,.5),1>H&&(H=1),z>G*H&&(z=G*H),K=z/x-1;var o=Math.pow(K+1,2).toFixed(1);x>z&&(z=x,Q!==!0&&zoomInfo2.addClass("Zoomdefault")),z==x&&Math.abs(S)<20&&(w.fadeOut(300*(1+et)),B.fadeIn(et*A),M.find(T).fadeIn(et*A),zoomInfo2.addClass("Zoomwarning")),U.css({height:1+97*(o-1)/(Math.pow(G*H/x,2)-1)+"%"}),zoomInfo2.html(e.zoomLeftText+o)}function r(){O=0,0>W&&(W=0,O=1),W>x&&(W=x,O=1),0>L&&(L=0,O=1),L>C&&(L=C,O=1),O&&ot>8&&a()}function s(){M.on("DOMMouseScroll",function(o){return e.mouseWheelSupport?(o.originalEvent.detail<0?d():f(),Q=!0,!1):void 0}).on("mousewheel",function(o){return e.mouseWheelSupport?(o.originalEvent.wheelDelta>=0?d():f(),Q=!0,!1):void 0})}function d(){P=1,g||z>=G*H||(z=w.width()/e.zoomFactor,w.stop(1,1).show(),et&&(B.stop(1,1).hide(),M.find(T).stop(1,1).hide()))}function f(){P=1,g||0>=K||(z=w.width()*e.zoomFactor)}function u(){$=250;for(var o=0;$>o;o++){var t=o/$,e=Math.pow(t,2)-Math.pow(t,4);it[o]=Math.pow(e,.5),it[2*$+o]=it[o]}for(var i=0;$>i;i++)it[i+$]=-it[$-i-1],it[3*$+i]=it[i+$]}function c(){u();var o=0;W=q,L=V,setTimeout(function(){_=setInterval(function(){4*$-1>o?o++:o=0;var t=o;o>$&&(t=2*$-o),o>3*$&&(t=o-4*$),W=q*(1-t/$),L=V*(1+2*it[o])},10+e.zoomTourSpeed)},e.zoomTourShowSpeed)}function m(){y=M.offset().left,F=M.offset().top,o(document).mousemove(function(o){W=o.pageX-y,L=o.pageY-F,e.dragMode&&(W=x-W,L=C-L)}).on("mouseover",function(o){W=o.pageX-y,L=o.pageY-F,e.dragMode&&(W=x-W,L=C-L)})}function h(o,t){o.css({cssText:"-webkit-filter:grayscale(1);filter:gray;"});var e=2;if(1e3!=ot){if(!(ot>8))return;e=1}T=document.createElement("canvas");var i=T.getContext("2d"),a=new Image;a.onload=function(){var o=x*e,n=C*e;T.width=o,T.height=n,i.drawImage(a,0,0,o,n);var r=i.getImageData(0,0,o,n);if(t===!0&&(t="#000000"),"sepia"==t&&(t="#FA9632"),"#"==t.substr(0,1)){t=t.replace(/#/g,"");for(var s=parseInt(t.substr(0,2),16),d=parseInt(t.substr(2,2),16),f=parseInt(t.substr(4,2),16),u=1.1,c=0;n>c;c++)for(var m=0;o>m;m++){var h=4*c*o+4*m,p=(r.data[h]+r.data[h+1]+r.data[h+2])/3;r.data[h]=p+s/5/u,r.data[h+1]=p+d/5/u,r.data[h+2]=p+f/5/u}}i.putImageData(r,0,0,0,0,o,n)},a.src=o.attr("src")}function p(){ot=1e3;var o,t=navigator.userAgent,e=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];e=e[2]?[e[1],e[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(o=t.match(/version\/([\.\d]+)/i))&&(e[2]=o[1]),"MSIE"==e[0]&&(ot=e[1])}function l(t){var e=["png","PNG","gif","GIF"];return o.inArray(t.substr(t.length-3,3),e)+1}instance++;var v,g,w,z,I,S,Z,b,T,y,F,M,x,q,C,V,k,W,L,O,D,E,P,A,B,G,N,X,Y,j,Q,H,J,K,R,U,$,_,ot,tt,et,it=[];B=o(this),p(),g=!0,A=e.speedInOut,tt=B.attr("src"),et=l(tt),B.wrap('<div class="imageContainer'+instance+'"'+B+'"></div>'),M=o(".imageContainer"+instance).css({zIndex:9998,display:"block",position:"relative",width:B.width(),height:B.height(),overflow:"visible"}).append('<div class="LZcontainer'+instance+'"></div><div class="liquid-zoom-caption"></div><div class="liquid-zoombar"><div class="LZ-bar"></div></div>'),x=M.width(),q=x/2,C=M.height(),V=C/2,v=o(".LZcontainer"+instance).css({zIndex:9998,position:"absolute",width:0,height:0,top:V,left:q,opacity:0,overflow:"hidden"}).append('<div class="Zoominfo2"/><div class="Zoominfo1">'+e.zoomInfoText+"</div>"),Z=o(".liquid-zoom-caption",M).hide(),R=o(".liquid-zoombar",M).hide(),U=o(".LZ-bar",M),M.on("click",function(){M.parent("a").length||(e.autoZoomTour&&(e.autoZoomTour=!1,e.mouseWheelSupport=!0,A=e.speedInOut,clearTimeout(_),m()),g?t():a())}).on("mouseenter",function(){x-20>W&&W>20&&C-20>L&&L>20||setTimeout(function(){t(),o(document).off("mouseover")},10)}).on("mouseleave",function(){e.autoZoomTour||a()}),e.blackWhitePreview?(h(B,e.blackWhitePreview),M.append(T).find(T).css({position:"absolute",width:x,height:C,top:0,left:0,opacity:0}).animate({opacity:1},300)):B.animate({opacity:1},300),e.autoZoomTour?(B.hide(),M.find(T).hide(),e.mouseWheelSupport=!1,A=e.zoomTourShowSpeed,c(),t()):m(),o(window).resize(function(){y=M.offset().left,F=M.offset().top,x=M.width(),q=x/2,C=M.height(),V=C/2}),e.zoomViewStartFactor=Math.pow(e.zoomViewStartFactor,.5),s()})}}(jQuery);